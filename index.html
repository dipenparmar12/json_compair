<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="theme-color" content="#08C988" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Online Text Compare" />
    <title>Compare JSON files online</title>
    <meta name="Description"
        content="FREE two-way JSON format, diff and merge tool. No Signup required. Nothing to install. All comparisons are 100% private, secure and happens locally right in your web browser" />
    <meta name="keywords" content="Online JSON Compare - Format and find differences between two JSON files" />
    <link rel="canonical" href="https://dipenparmar12.github.io/json_compair/" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <link rel="shortcut icon" href="./img/onlinetextcompare.png" />
    <link rel="stylesheet" href="./css/ccsiteV6.css" />
    <link rel="stylesheet" type="text/css" href="./css/codemirror.css" />
    <link rel="stylesheet" type="text/css" href="./css/merge.css" />
    <script src="./js/codemirror.js"></script>
    <script src="./js/diff_match_patch.js"></script>
    <script src="./js/merge.js"></script>
    <script src="./js/javascript.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .contentPage {
            max-width: 100% !important;
            padding: 0 !important;
        }

        #container {
            background-color: white;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        #view {
            width: 100%;
            padding: 0;
            margin: 0;
        }

        .CodeMirror-merge {
            width: 100%;
        }

        .CodeMirror-merge-pane {
            width: 47%;
        }

        .CodeMirror-merge-gap {
            width: 6%;
        }

        #container:fullscreen #view {
            width: 100%;
        }

        #container:fullscreen .CodeMirror-merge,
        #container:fullscreen .CodeMirror-merge .CodeMirror {
            height: 100vh;
        }

        #viewHeader {
            padding: 10px;
            margin: 8px auto 16px auto;
            text-align: center;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .toggle-button {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            margin: 0 5px;
            font-size: 14px;
        }

        .toggle-button.active {
            background-color: #4CAF50;
            color: white;
        }

        .CodeMirror-merge-collapsed-line {
            display: none !important;
        }

        .CodeMirror-merge-spacer {
            display: none;
        }

        select.toggle-button {
            height: 30px;
        }

        #diff-status {
            text-align: center;
            margin: 10px 0;
            font-size: 16px;
            color: #333;
        }

        @media (max-width: 1250px) {
            #fs {
                visibility: hidden;
            }

            #viewHeader {
                margin: auto;
                text-align: center;
                height: 40px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }
        }

        .CodeMirror-merge-pane.show-diffs-only .CodeMirror-line {
            display: none;
        }

        .CodeMirror-merge-pane.show-diffs-only .CodeMirror-merge-r-chunk .CodeMirror-line,
        .CodeMirror-merge-pane.show-diffs-only .CodeMirror-merge-l-chunk .CodeMirror-line {
            display: block;
            background-color: #f0f8ff;  /* Light blue background for better visibility */
        }

        /* Add some padding around diff chunks */
        .CodeMirror-merge-pane.show-diffs-only .CodeMirror-merge-r-chunk,
        .CodeMirror-merge-pane.show-diffs-only .CodeMirror-merge-l-chunk {
            padding: 5px 0;
            margin: 5px 0;
            border-top: 2px solid #ddd;
            border-bottom: 2px solid #ddd;
        }

        /* Add context lines before and after diffs */
        .CodeMirror-merge-pane.show-diffs-only .CodeMirror-merge-r-chunk .CodeMirror-line:first-child,
        .CodeMirror-merge-pane.show-diffs-only .CodeMirror-merge-l-chunk .CodeMirror-line:first-child {
            border-top: 1px solid #eee;
            padding-top: 5px;
        }

        .CodeMirror-merge-pane.show-diffs-only .CodeMirror-merge-r-chunk .CodeMirror-line:last-child,
        .CodeMirror-merge-pane.show-diffs-only .CodeMirror-merge-l-chunk .CodeMirror-line:last-child {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        /* Clear button styling */
        .clear-btn {
            position: absolute;
            top: 5px;
            z-index: 100;
            background-color: #f8f9fa;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 3px 8px;
            font-size: 12px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .clear-btn:hover {
            opacity: 1;
            background-color: #e9ecef;
        }
        
        .clear-btn-left {
            right: 10px;
        }
        
        .clear-btn-right {
            right: 10px;
        }

        /* Paste button styling */
        .paste-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            background-color: #f8f9fa;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .paste-btn:hover {
            opacity: 1;
            background-color: #e9ecef;
        }

        /* Minimap styles */
        .editor-wrapper {
            position: relative;
            height: 100%;
            width: 100%;
        }
        
        .minimap {
            position: absolute;
            right: 0;
            top: 0;
            width: 60px;
            height: 100%;
            background: #f5f5f5;
            border-left: 1px solid #ddd;
            overflow: hidden;
            z-index: 10;
            opacity: 0.8;
            transition: opacity 0.2s, width 0.2s;
        }

        .minimap:hover {
            opacity: 1;
        }

        .minimap-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            transform-origin: top left;
            pointer-events: none;
            opacity: 0.7;
            background: white;
        }

        .minimap-slider {
            position: absolute;
            right: 0;
            width: 60px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            cursor: pointer;
        }

        .diff-highlights {
            position: absolute;
            right: 0;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .diff-added {
            background-color: rgba(0, 255, 0, 0.3);
            position: absolute;
            right: 0;
            width: 100%;
            height: 2px;
        }

        .diff-removed {
            background-color: rgba(255, 0, 0, 0.3);
            position: absolute;
            right: 0;
            width: 100%;
            height: 2px;
        }

        @media (max-width: 1250px) {
            .minimap {
                width: 30px;
            }
            .minimap-slider {
                width: 30px;
            }
        }

        /* Make sure the editor panes account for the minimap width */
        .CodeMirror-merge-pane {
            width: 47%;
            position: relative;
        }
    </style>
</head>

<body>
    <article id="ArticlePage" class="contentPage cover">
        <div class="intro" style="max-width: 100%; margin: 0; padding: 10px 0; text-align: center; background-color: #f8f9fa;">
            <div class="controls">
                <button id="btn-format" class="toggle-button">Format &amp; Compare JSON</button>
                <!-- Additional controls will be added by JavaScript -->
            </div>
        </div>
    </article>
    <div id="container">
        <div id="view"></div>
        <div id="diff-status">Found 0 differences</div>
    </div>

    <script type="text/javascript">
        // Storage Manager Implementation
        const StorageManager = {
            STORAGE_KEY: 'json_compare_data',
            EXPIRY_DAYS: 30,

            saveToStorage: function(leftContent, rightContent) {
                const data = {
                    left: leftContent,
                    right: rightContent,
                    timestamp: new Date().getTime()
                };
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
            },

            loadFromStorage: function() {
                const storedData = localStorage.getItem(this.STORAGE_KEY);
                if (!storedData) return null;

                const data = JSON.parse(storedData);
                const now = new Date().getTime();
                const age = now - data.timestamp;
                const expiryTime = this.EXPIRY_DAYS * 24 * 60 * 60 * 1000;

                if (age > expiryTime) {
                    localStorage.removeItem(this.STORAGE_KEY);
                    return null;
                }

                return {
                    left: data.left,
                    right: data.right
                };
            }
        };

        // Default templates
        const DefaultTemplates = {
            simple: {
                left: JSON.stringify({
                    name: "John",
                    age: 30,
                    city: "New York"
                }, null, 3),
                right: JSON.stringify({
                    name: "John",
                    age: 31,
                    city: "Boston"
                }, null, 3)
            },
            complex: {
                left: JSON.stringify({
                    users: [{
                        id: 1,
                        name: "Alice",
                        active: true
                    }, {
                        id: 2,
                        name: "Bob",
                        active: false
                    }],
                    settings: {
                        theme: "dark",
                        notifications: true
                    }
                }, null, 3),
                right: JSON.stringify({
                    users: [{
                        id: 1,
                        name: "Alice",
                        active: false
                    }, {
                        id: 3,
                        name: "Charlie",
                        active: true
                    }],
                    settings: {
                        theme: "light",
                        notifications: true
                    }
                }, null, 3)
            }
        };

        // Function to sort JSON object keys recursively
        function sortJSONKeys(obj) {
            // Return if not an object or if it's null or an array
            if (obj === null || typeof obj !== 'object' || Array.isArray(obj)) {
                return obj;
            }
            
            // Create a new sorted object
            const sortedObj = {};
            const keys = Object.keys(obj).sort();
            
            for (const key of keys) {
                // Recursively sort nested objects
                sortedObj[key] = sortJSONKeys(obj[key]);
            }
            
            return sortedObj;
        }
        
        // Function to sort array items if they are objects
        function sortJSONArray(arr) {
            if (!Array.isArray(arr)) {
                return arr;
            }
            
            return arr.map(item => {
                if (typeof item === 'object' && item !== null) {
                    return sortJSONKeys(item);
                }
                return item;
            });
        }

        // Initialize enhanced merge view
        function initializeMergeView(target) {
            // Load saved content or use defaults
            const savedContent = StorageManager.loadFromStorage();
            const initialContent = savedContent || DefaultTemplates.simple;

            // Create merge view with enhanced options
            const mv = CodeMirror.MergeView(target, {
                value: initialContent.left,
                origLeft: null,
                orig: initialContent.right,
                lineNumbers: true,
                mode: "application/json",
                showDifferences: true,
                connect: "align",
                collapseIdentical: false,
                revertButtons: true,
                allowEditingOriginals: true,
                highlightDifferences: true,
                lineWrapping: true,
                styleActiveLine: true,
                chunkClassLocation: ["background", "wrap", "gutter"]
            });

            // Add scroll synchronization with toggle
            let scrollLocked = true;
            const leftEditor = mv.editor();
            const rightEditor = mv.rightOriginal();

            function syncScroll(sourceEditor, targetEditor) {
                if (!scrollLocked) return;
                const info = sourceEditor.getScrollInfo();
                targetEditor.scrollTo(info.left, info.top);
            }

            leftEditor.on("scroll", () => syncScroll(leftEditor, rightEditor));
            rightEditor.on("scroll", () => syncScroll(rightEditor, leftEditor));

            // Add UI controls
            const controls = document.querySelector('.controls');

            // Add scroll lock toggle
            const scrollLockBtn = document.createElement('button');
            scrollLockBtn.className = 'toggle-button active';
            scrollLockBtn.textContent = 'Scroll Lock';
            scrollLockBtn.onclick = () => {
                scrollLocked = !scrollLocked;
                scrollLockBtn.classList.toggle('active');
            };
            // controls.appendChild(scrollLockBtn);

            // Add Show Only Differences toggle
            const showDiffsBtn = document.createElement('button');
            showDiffsBtn.className = 'toggle-button';
            showDiffsBtn.textContent = 'Show Only Differences';
            
            showDiffsBtn.onclick = () => {
            showDiffsBtn.classList.toggle('active');
            const showOnlyDiffs = showDiffsBtn.classList.contains('active');
            
            const leftPane = leftEditor.getWrapperElement().parentNode;
            const rightPane = rightEditor.getWrapperElement().parentNode;
            
            leftPane.classList.toggle('show-diffs-only', showOnlyDiffs);
            rightPane.classList.toggle('show-diffs-only', showOnlyDiffs);
            
            // If showing diffs, ensure chunks are expanded
            if (showOnlyDiffs) {
                // Get all collapsed markers
                const markers = leftEditor.getAllMarks();
                markers.forEach(marker => {
                    if (marker.collapsed) {
                        marker.clear();
                    }
                });
            }
            
            // Refresh both editors
            leftEditor.refresh();
            rightEditor.refresh();
            
            // Adjust viewport to show first diff if exists
            if (showOnlyDiffs) {
                const chunks = mv.rightChunks();
                if (chunks && chunks.length > 0) {
                    leftEditor.scrollIntoView({line: chunks[0].from, ch: 0}, 100);
                }
            }
        };
controls.insertBefore(showDiffsBtn, scrollLockBtn.nextSibling);

            // Add Sort JSON Keys button
            const sortKeysBtn = document.createElement('button');
            sortKeysBtn.className = 'toggle-button';
            sortKeysBtn.textContent = 'Sort JSON Keys';
            sortKeysBtn.onclick = () => {
                try {
                    // Parse and sort left editor content
                    let leftObj = JSON.parse(leftEditor.getValue());
                    if (Array.isArray(leftObj)) {
                        leftObj = sortJSONArray(leftObj);
                    } else {
                        leftObj = sortJSONKeys(leftObj);
                    }
                    leftEditor.setValue(JSON.stringify(leftObj, null, 3));
                    
                    // Parse and sort right editor content
                    let rightObj = JSON.parse(rightEditor.getValue());
                    if (Array.isArray(rightObj)) {
                        rightObj = sortJSONArray(rightObj);
                    } else {
                        rightObj = sortJSONKeys(rightObj);
                    }
                    rightEditor.setValue(JSON.stringify(rightObj, null, 3));
                    
                    // Realign chunks after sorting - fix the error
                    setTimeout(() => {
                        if (mv.alignChunks) {
                            mv.alignChunks();
                        }
                        updateDiffStatus(mv);
                    }, 0);

                } catch (e) {
                    console.error("Failed to sort JSON:", e);
                    alert("Failed to sort JSON. Please ensure both sides contain valid JSON.");
                }
            };
            // Insert the sort button after the format button
            const formatBtn = document.getElementById("btn-format");
            controls.insertBefore(sortKeysBtn, formatBtn.nextSibling);

            // Add template selector
            const templateSelect = document.createElement('select');
            templateSelect.className = 'toggle-button';
            templateSelect.innerHTML = `
                <option value="simple">Simple Template</option>
                <option value="complex">Complex Template</option>
            `;
            templateSelect.onchange = () => {
                const template = DefaultTemplates[templateSelect.value];
                leftEditor.setValue(template.left);
                rightEditor.setValue(template.right);
            };
            controls.appendChild(templateSelect);
            
            // Add Clear All button
            const clearAllBtn = document.createElement('button');
            clearAllBtn.className = 'toggle-button';
            clearAllBtn.textContent = 'Clear All';
            clearAllBtn.style.display = 'none'; // Initially hidden
            clearAllBtn.onclick = () => {
                leftEditor.setValue('');
                rightEditor.setValue('');
                updateDiffStatus(mv);
            };
            controls.appendChild(clearAllBtn);
            
            // Add individual clear buttons to each pane
            function addClearButton(editor, side) {
                const wrapper = editor.getWrapperElement();
                const clearBtn = document.createElement('button');
                clearBtn.className = `clear-btn clear-btn-${side}`;
                clearBtn.textContent = 'Clear';
                clearBtn.style.display = 'none'; // Initially hidden
                clearBtn.onclick = (e) => {
                    e.stopPropagation();
                    editor.setValue('');
                    editor.focus(); // Focus the editor after clearing
                    updateDiffStatus(mv);
                };
                
                // Insert the button inside the editor's wrapper
                wrapper.parentNode.style.position = 'relative';
                wrapper.parentNode.appendChild(clearBtn);
                
                return clearBtn;
            }
            
            // Add paste buttons to each pane
            function addPasteButton(editor, side) {
                const wrapper = editor.getWrapperElement();
                const pasteBtn = document.createElement('button');
                pasteBtn.className = `paste-btn paste-btn-${side}`;
                pasteBtn.textContent = 'Paste from Clipboard';
                pasteBtn.style.display = 'none'; // Initially hidden
                
                pasteBtn.onclick = async (e) => {
                    e.stopPropagation();
                    try {
                        // Request clipboard permission and get text
                        const text = await navigator.clipboard.readText();
                        if (text) {
                            // Try to format if it's valid JSON
                            try {
                                const formatted = JSON.stringify(JSON.parse(text), null, 3);
                                editor.setValue(formatted);
                            } catch {
                                // If not valid JSON, just paste as-is
                                editor.setValue(text);
                            }
                            editor.focus();
                            updateDiffStatus(mv);
                        }
                    } catch (err) {
                        console.error("Clipboard permission denied:", err);
                        alert("Please allow clipboard access to use the paste feature");
                    }
                };
                
                // Insert the button inside the editor's wrapper
                wrapper.parentNode.appendChild(pasteBtn);
                
                return pasteBtn;
            }
            
            // Add clear buttons to both editors
            const leftClearBtn = addClearButton(leftEditor, 'left');
            const rightClearBtn = addClearButton(rightEditor, 'right');
            
            // Add paste buttons to both editors
            const leftPasteBtn = addPasteButton(leftEditor, 'left');
            const rightPasteBtn = addPasteButton(rightEditor, 'right');
            
            // Function to update button visibility based on content
            function updateClearButtonsVisibility() {
                const leftContent = leftEditor.getValue().trim();
                const rightContent = rightEditor.getValue().trim();
                
                // Individual clear buttons
                leftClearBtn.style.display = leftContent ? 'block' : 'none';
                rightClearBtn.style.display = rightContent ? 'block' : 'none';
                
                // Individual paste buttons - only show when content is empty
                leftPasteBtn.style.display = leftContent ? 'none' : 'block';
                rightPasteBtn.style.display = rightContent ? 'none' : 'block';
                
                // Clear All button - only visible if at least one editor has content
                clearAllBtn.style.display = (leftContent || rightContent) ? 'inline-block' : 'none';
            }
            
            // Set initial button visibility based on initial content
            updateClearButtonsVisibility();
            
            // Auto-save content changes
            const saveContent = () => {
                StorageManager.saveToStorage(
                    leftEditor.getValue(),
                    rightEditor.getValue()
                );
                updateClearButtonsVisibility();
            };

            leftEditor.on("change", (instance, changeObj) => {
                if (changeObj.origin === "paste") {
                    try {
                        var formatted = JSON.stringify(JSON.parse(instance.getValue()), null, 3);
                        instance.setValue(formatted);
                    } catch (e) {
                        // Ignore parse errors
                    }
                }
                saveContent();
                updateDiffStatus(mv);
            });

            rightEditor.on("change", (instance, changeObj) => {
                if (changeObj.origin === "paste") {
                    try {
                        var formatted = JSON.stringify(JSON.parse(instance.getValue()), null, 3);
                        instance.setValue(formatted);
                    } catch (e) {
                        // Ignore parse errors
                    }
                }
                saveContent();
                updateDiffStatus(mv);
            });

            // Enhance format button
            document.getElementById("btn-format").onclick = function() {
                const leftContent = leftEditor.getValue().trim();
                const rightContent = rightEditor.getValue().trim();
                
                // Only proceed if both sides have content
                if (!leftContent || !rightContent) {
                    document.getElementById('diff-status').textContent = "Please provide content in both panels";
                    return;
                }
                
                try {
                    leftEditor.setValue(JSON.stringify(JSON.parse(leftEditor.getValue()), null, 3));
                    rightEditor.setValue(JSON.stringify(JSON.parse(rightEditor.getValue()), null, 3));
                    mv.right.operation(() => {
                        mv.alignChunks();
                    });
                } catch (e) {
                    // alert("Invalid JSON detected. Please check your input.");
                }
                updateDiffStatus(mv);
            };

            function createMinimap(editor, isRight) {
                // Create wrapper to contain editor and minimap
                const wrapper = document.createElement('div');
                wrapper.className = 'editor-wrapper';
                
                // Get the editor's parent and replace the editor with our wrapper
                const parent = editor.getWrapperElement().parentNode;
                parent.appendChild(wrapper);
                wrapper.appendChild(editor.getWrapperElement());

                // Create minimap container
                const minimap = document.createElement('div');
                minimap.className = 'minimap';
                wrapper.appendChild(minimap);

                // Create minimap content container (will hold a clone of editor content)
                const minimapContent = document.createElement('div');
                minimapContent.className = 'minimap-content';
                minimap.appendChild(minimapContent);

                // Create slider to indicate viewport position
                const slider = document.createElement('div');
                slider.className = 'minimap-slider';
                minimap.appendChild(slider);

                // Create container for diff highlights
                const diffContainer = document.createElement('div');
                diffContainer.className = 'diff-highlights';
                minimap.appendChild(diffContainer);

                // Update minimap content function
                function updateMinimap() {
                    // Clone the editor's content for the minimap
                    const content = editor.getWrapperElement().querySelector('.CodeMirror-lines').cloneNode(true);
                    minimapContent.innerHTML = '';
                    minimapContent.appendChild(content);
                    
                    // Scale the content to fit minimap
                    const scale = 0.2;
                    minimapContent.style.transform = `scale(${scale})`;
                    minimapContent.style.width = `${100/scale}%`;
                }

                // Update slider position based on editor scroll position
                function updateSlider() {
                    const info = editor.getScrollInfo();
                    const ratio = info.clientHeight / info.height;
                    const sliderHeight = Math.max(ratio * info.clientHeight, 20);
                    const scrollRatio = info.top / (info.height - info.clientHeight);
                    
                    slider.style.height = `${sliderHeight}px`;
                    slider.style.top = `${scrollRatio * (info.clientHeight - sliderHeight)}px`;
                }

                // Add click-and-drag functionality to the slider
                minimap.addEventListener('mousedown', (e) => {
                    const startY = e.clientY;
                    const startTop = parseInt(slider.style.top || 0);
                    const info = editor.getScrollInfo();
                    
                    function onMouseMove(e) {
                        const delta = e.clientY - startY;
                        const newTop = Math.max(0, Math.min(info.clientHeight - parseInt(slider.style.height), startTop + delta));
                        const scrollRatio = newTop / (info.clientHeight - parseInt(slider.style.height));
                        editor.scrollTo(null, scrollRatio * (info.height - info.clientHeight));
                    }
                    
                    function onMouseUp() {
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    }
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                });

                // Update diff highlights in the minimap
                function updateDiffHighlights() {
                    diffContainer.innerHTML = '';
                    
                    // Get diff chunks from the merge view
                    const chunks = mv.rightChunks();
                    if (!chunks || chunks.length === 0) return;
                    
                    const lineHeight = editor.defaultTextHeight() * 0.2; // Scaled line height
                    
                    chunks.forEach(chunk => {
                        const marker = document.createElement('div');
                        marker.className = isRight ? 'diff-removed' : 'diff-added';
                        
                        // Position based on the editor's line numbers
                        const startLine = isRight ? chunk.origFrom : chunk.editFrom;
                        const endLine = isRight ? chunk.origTo : chunk.editTo;
                        const top = startLine * lineHeight;
                        const height = (endLine - startLine) * lineHeight;
                        
                        marker.style.top = `${top}px`;
                        marker.style.height = `${Math.max(2, height)}px`;
                        diffContainer.appendChild(marker);
                    });
                }

                // Subscribe to events to keep minimap updated
                editor.on('change', () => {
                    setTimeout(() => {
                        updateMinimap();
                        updateSlider();
                        updateDiffHighlights();
                    }, 100);
                });
                
                editor.on('scroll', updateSlider);
                
                // Initialize
                updateMinimap();
                updateSlider();
                updateDiffHighlights();
                
                return { minimap, updateDiffHighlights };
            }

            // Initialize minimaps after merge view is ready
            const leftMinimap = createMinimap(leftEditor);
            const rightMinimap = createMinimap(rightEditor, true);

            // Update minimaps when diffs change
            mv.setShowDifferences(true); // Ensure diffs are shown
            mv.right.on("updateDiff", () => {
                leftMinimap.updateDiffHighlights();
                rightMinimap.updateDiffHighlights();
            });

            updateDiffStatus(mv);
            return mv;
        }

        function updateDiffStatus(mv) {
            const leftContent = mv.editor().getValue().trim();
            const rightContent = mv.rightOriginal().getValue().trim();
            
            // Only count differences if both sides have content
            if (!leftContent || !rightContent) {
                document.getElementById('diff-status').textContent = "Add JSON content to both sides to compare";
                return;
            }
            
            const diffs = mv.rightChunks().length;
            document.getElementById('diff-status').textContent = `Found ${diffs} differences`;
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            const target = document.getElementById("view");
            const mv = initializeMergeView(target);
        });
    </script>
</body>

</html>