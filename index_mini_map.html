<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="theme-color" content="#08C988" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Online Text Compare" />
    <title>Compare JSON files online</title>
    <meta name="Description"
        content="FREE two-way JSON format, diff and merge tool. No Signup required. Nothing to install. All comparisons are 100% private, secure and happens locally right in your web browser" />
    <meta name="keywords" content="Online JSON Compare - Format and find differences between two JSON files" />
    <link rel="canonical" href="https://4U5yLYe7Hryx.com/json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <link rel="shortcut icon" href="./img/onlinetextcompare.png" />
    <link rel="stylesheet" href="./css/ccsiteV6.css" />
    <link rel="stylesheet" type="text/css" href="./css/codemirror.css" />
    <link rel="stylesheet" type="text/css" href="./css/merge.css" />
    <script src="./js/codemirror.js"></script>
    <script src="./js/diff_match_patch.js"></script>
    <script src="./js/merge.js"></script>
    <script src="./js/javascript.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .contentPage {
            max-width: 100% !important;
            padding: 0 !important;
        }

        #container {
            background-color: white;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        #view {
            width: 100%;
            padding: 0;
            margin: 0;
        }

        .CodeMirror-merge {
            width: 100%;
        }

        .CodeMirror-merge-pane {
            width: 47%;
        }

        .CodeMirror-merge-gap {
            width: 6%;
        }

        #container:fullscreen #view {
            width: 100%;
        }

        #container:fullscreen .CodeMirror-merge,
        #container:fullscreen .CodeMirror-merge .CodeMirror {
            height: 100vh;
        }

        #viewHeader {
            padding: 10px;
            margin: 8px auto 16px auto;
            text-align: center;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .toggle-button {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            margin: 0 5px;
            font-size: 14px;
        }

        .toggle-button.active {
            background-color: #4CAF50;
            color: white;
        }

        .CodeMirror-merge-collapsed-line {
            display: none !important;
        }

        .CodeMirror-merge-spacer {
            display: none;
        }

        select.toggle-button {
            height: 30px;
        }

        @media (max-width: 1250px) {
            #fs {
                visibility: hidden;
            }

            #viewHeader {
                margin: auto;
                text-align: center;
                height: 40px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Base styles */
        body { margin: 0; padding: 0; }
        .contentPage { max-width: 100% !important; padding: 0 !important; }
        #container { width: 100%; margin: 0; padding: 0; background-color: white; }
        #view { width: 100%; padding: 0; margin: 0; }

        /* CodeMirror layout */
        .CodeMirror-merge { 
            width: 100%;
            height: calc(100vh - 100px);
        }
        .CodeMirror-merge-pane {
            width: 47%;
            position: relative;
        }
        .CodeMirror-merge-gap { width: 6%; }
        .CodeMirror { height: 100%; }

        /* Minimap styles */
        .editor-wrapper {
            position: relative;
            height: 100%;
            width: 100%;
        }
        
        .minimap {
            position: absolute;
            right: 0;
            top: 0;
            width: 120px;
            height: 100%;
            background: #f5f5f5;
            border-left: 1px solid #ddd;
            overflow: hidden;
            z-index: 10;
        }

        .minimap-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            transform-origin: top left;
            pointer-events: none;
            opacity: 0.6;
            background: white;
        }

        .minimap-slider {
            position: absolute;
            right: 0;
            width: 120px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            cursor: pointer;
        }

        /* Control styles */
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .toggle-button {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
        }

        .toggle-button.active {
            background-color: #4CAF50;
            color: white;
        }

        /* Responsive adjustments */
        @media (max-width: 1250px) {
            .minimap { width: 60px; }
            .minimap-slider { width: 60px; }
        }

        .minimap {
            width: 40px;
            opacity: 0.8;
        }

        .minimap-slider {
            width: 40px;
        }

        .minimap .diff-added {
            background-color: rgba(0, 255, 0, 0.3);
            position: absolute;
            right: 0;
            width: 100%;
            height: 2px;
        }

        .minimap .diff-removed {
            background-color: rgba(255, 0, 0, 0.3);
            position: absolute;
            right: 0;
            width: 100%;
            height: 2px;
        }

        @media (max-width: 1250px) {
            .minimap, .minimap-slider {
                width: 30px;
            }
        }
    </style>
</head>

<body>
    <article id="ArticlePage" class="contentPage cover">
        <div class="intro" style="max-width: 100%; margin: 0; padding: 10px 0; text-align: center; background-color: #f8f9fa;">
            <div class="controls">
                <button id="btn-format" class="toggle-button">Format &amp; Compare JSON</button>
                <!-- Additional controls will be added by JavaScript -->
            </div>
        </div>
    </article>
    <div id="container">
        <div id="view"></div>
    </div>

    <script type="text/javascript">
        // Storage Manager Implementation
        const StorageManager = {
            STORAGE_KEY: 'json_compare_data',
            EXPIRY_DAYS: 30,

            saveToStorage: function(leftContent, rightContent) {
                const data = {
                    left: leftContent,
                    right: rightContent,
                    timestamp: new Date().getTime()
                };
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
            },

            loadFromStorage: function() {
                const storedData = localStorage.getItem(this.STORAGE_KEY);
                if (!storedData) return null;

                const data = JSON.parse(storedData);
                const now = new Date().getTime();
                const age = now - data.timestamp;
                const expiryTime = this.EXPIRY_DAYS * 24 * 60 * 60 * 1000;

                if (age > expiryTime) {
                    localStorage.removeItem(this.STORAGE_KEY);
                    return null;
                }

                return {
                    left: data.left,
                    right: data.right
                };
            }
        };

        // Default templates
        const DefaultTemplates = {
            simple: {
                left: JSON.stringify({
                    name: "John",
                    age: 30,
                    city: "New York"
                }, null, 3),
                right: JSON.stringify({
                    name: "John",
                    age: 31,
                    city: "Boston"
                }, null, 3)
            },
            complex: {
                left: JSON.stringify({
                    users: [{
                        id: 1,
                        name: "Alice",
                        active: true
                    }, {
                        id: 2,
                        name: "Bob",
                        active: false
                    }],
                    settings: {
                        theme: "dark",
                        notifications: true
                    }
                }, null, 3),
                right: JSON.stringify({
                    users: [{
                        id: 1,
                        name: "Alice",
                        active: false
                    }, {
                        id: 3,
                        name: "Charlie",
                        active: true
                    }],
                    settings: {
                        theme: "light",
                        notifications: true
                    }
                }, null, 3)
            }
        };

        // Initialize enhanced merge view
        function initializeMergeView(target) {
            // Load saved content or use defaults
            const savedContent = StorageManager.loadFromStorage();
            const initialContent = savedContent || DefaultTemplates.simple;

            // Create merge view with enhanced options

            const mv = CodeMirror.MergeView(target, {
                value: initialContent.left,
                origLeft: null,
                orig: initialContent.right,
                lineNumbers: true,
                mode: "application/json",
                showDifferences: true,
                connect: "align",
                collapseIdentical: false,
                revertButtons: true,
                allowEditingOriginals: true,
                highlightDifferences: true,
                lineWrapping: true
            });

            // Add scroll synchronization with toggle
            let scrollLocked = true;
            const leftEditor = mv.editor();
            const rightEditor = mv.rightOriginal();

            function syncScroll(sourceEditor, targetEditor) {
                if (!scrollLocked) return;
                const info = sourceEditor.getScrollInfo();
                targetEditor.scrollTo(info.left, info.top);
            }

            leftEditor.on("scroll", () => syncScroll(leftEditor, rightEditor));
            rightEditor.on("scroll", () => syncScroll(rightEditor, leftEditor));

            // Add UI controls
            const controls = document.querySelector('.controls');

            // Add scroll lock toggle
            const scrollLockBtn = document.createElement('button');
            scrollLockBtn.className = 'toggle-button active';
            scrollLockBtn.textContent = 'Scroll Lock';
            scrollLockBtn.onclick = () => {
                scrollLocked = !scrollLocked;
                scrollLockBtn.classList.toggle('active');
            };
            controls.appendChild(scrollLockBtn);

            // Add template selector
            const templateSelect = document.createElement('select');
            templateSelect.className = 'toggle-button';
            templateSelect.innerHTML = `
                <option value="simple">Simple Template</option>
                <option value="complex">Complex Template</option>
            `;
            templateSelect.onchange = () => {
                const template = DefaultTemplates[templateSelect.value];
                leftEditor.setValue(template.left);
                rightEditor.setValue(template.right);
            };
            controls.appendChild(templateSelect);

            // Auto-save content changes
            const saveContent = () => {
                StorageManager.saveToStorage(
                    leftEditor.getValue(),
                    rightEditor.getValue()
                );
            };

            leftEditor.on("change", (instance, changeObj) => {
                if (changeObj.origin === "paste") {
                    try {
                        var formatted = JSON.stringify(JSON.parse(instance.getValue()), null, 3);
                        instance.setValue(formatted);
                    } catch (e) {
                        // Ignore parse errors
                    }
                }
                saveContent();
            });

            rightEditor.on("change", (instance, changeObj) => {
                if (changeObj.origin === "paste") {
                    try {
                        var formatted = JSON.stringify(JSON.parse(instance.getValue()), null, 3);
                        instance.setValue(formatted);
                    } catch (e) {
                        // Ignore parse errors
                    }
                }
                saveContent();
            });

            // Enhance format button
            document.getElementById("btn-format").onclick = function() {
                try {
                    leftEditor.setValue(JSON.stringify(JSON.parse(leftEditor.getValue()), null, 3));
                    rightEditor.setValue(JSON.stringify(JSON.parse(rightEditor.getValue()), null, 3));
                    mv.right.operation(() => {
                        mv.alignChunks();
                    });
                } catch (e) {
                    // alert("Invalid JSON detected. Please check your input.");
                }
            };


            function createMinimap(editor, isRight) {
                const wrapper = document.createElement('div');
                wrapper.className = 'editor-wrapper';
                editor.getWrapperElement().parentNode.appendChild(wrapper);
                wrapper.appendChild(editor.getWrapperElement());

                const minimap = document.createElement('div');
                minimap.className = 'minimap';
                wrapper.appendChild(minimap);

                const minimapContent = document.createElement('div');
                minimapContent.className = 'minimap-content';
                minimap.appendChild(minimapContent);

                const slider = document.createElement('div');
                slider.className = 'minimap-slider';
                minimap.appendChild(slider);

                function updateMinimap() {
                    const content = editor.getWrapperElement().querySelector('.CodeMirror-lines').cloneNode(true);
                    minimapContent.innerHTML = '';
                    minimapContent.appendChild(content);
                    
                    const scale = 0.2;
                    minimapContent.style.transform = `scale(${scale})`;
                    minimapContent.style.width = `${100/scale}%`;
                }

                function updateSlider() {
                    const info = editor.getScrollInfo();
                    const ratio = info.clientHeight / info.height;
                    const sliderHeight = Math.max(ratio * info.clientHeight, 20);
                    const scrollRatio = info.top / (info.height - info.clientHeight);
                    
                    slider.style.height = `${sliderHeight}px`;
                    slider.style.top = `${scrollRatio * (info.clientHeight - sliderHeight)}px`;
                }

                minimap.addEventListener('mousedown', (e) => {
                    const startY = e.clientY;
                    const startTop = parseInt(slider.style.top || 0);
                    const info = editor.getScrollInfo();
                    
                    function onMouseMove(e) {
                        const delta = e.clientY - startY;
                        const newTop = Math.max(0, Math.min(info.clientHeight - parseInt(slider.style.height), startTop + delta));
                        const scrollRatio = newTop / (info.clientHeight - parseInt(slider.style.height));
                        editor.scrollTo(null, scrollRatio * (info.height - info.clientHeight));
                    }
                    
                    function onMouseUp() {
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    }
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                });

                editor.on('change', () => {
                    setTimeout(updateMinimap, 100);
                    updateSlider();
                });
                
                editor.on('scroll', updateSlider);
                
                updateMinimap();
                updateSlider();
            }

            createMinimap(mv.editor());
            createMinimap(mv.rightOriginal(), true);

            const diffContainer = document.createElement('div');
            diffContainer.className = 'diff-highlights';
            minimap.appendChild(diffContainer);

            function updateDiffHighlights() {
                diffContainer.innerHTML = '';
                const diffs = mv.leftOriginal() ? 
                    CodeMirror.diff(mv.leftOriginal().getValue(), editor.getValue()) :
                    CodeMirror.diff(mv.editor().getValue(), mv.rightOriginal().getValue());
                
                let lineOffset = 0;
                const lineHeight = editor.defaultTextHeight() * 0.2; // Scaled line height

                diffs.forEach(diff => {
                    if (diff[0] !== 0) { // 1 for addition, -1 for deletion
                        const marker = document.createElement('div');
                        marker.className = diff[0] === 1 ? 'diff-added' : 'diff-removed';
                        marker.style.top = `${lineOffset * lineHeight}px`;
                        marker.style.height = `${diff[1].length * lineHeight}px`;
                        diffContainer.appendChild(marker);
                    }
                    lineOffset += diff[1].length;
                });
            }

            editor.on('change', () => {
                updateDiffHighlights();
                // Previous change handlers
            });

            updateDiffHighlights();
            
            return mv;
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            const target = document.getElementById("view");
            const mv = initializeMergeView(target);
        });
    </script>
</body>

</html>